<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking de Projetos</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Flowbite CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
    
    <style>
        .barra-progresso {
            height: 8px;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            border-radius: 4px;
            transition: width 1s ease-in-out;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }
        .barra-container {
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            height: 8px;
        }
        .ranking-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .position-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            color: #1a202c;
            font-weight: bold;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        .position-badge.silver {
            background: linear-gradient(45deg, #c0c0c0, #e2e8f0);
        }
        .position-badge.bronze {
            background: linear-gradient(45deg, #cd7f32, #d69e2e);
        }
        .position-badge.regular {
            background: linear-gradient(45deg, #4a5568, #718096);
            color: white;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="ranking-card text-white mb-8">
                <h1 class="text-4xl font-bold mb-2">游끥 Ranking de Projetos</h1>
                <p class="text-lg opacity-90">Descubra os projetos mais votados pela comunidade</p>
            </div>
        </div>

        <!-- DataTable Container -->
        <div class="table-container">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Classifica칞칚o Geral</h2>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-600">Total de projetos:</span>
                        <span id="total-projetos" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-semibold">-</span>
                    </div>
                </div>

                <table id="ranking-table" class="w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Posi칞칚o
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Projeto
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Votos
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Popularidade
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Flowbite JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-datatables/7.3.2/umd/simple-datatables.js"></script>

    <script>

        let dataTableInstance = null;

        function carregarRanking() {
            // Tenta carregar do arquivo JSON, sen칚o usa dados de exemplo
            fetch('ranking.json')
                .then(res => {
                    if (!res.ok) throw new Error('Arquivo n칚o encontrado');
                    return res.json();
                })
                .then(data => {
                    console.log('Dados carregados do JSON:', data);
                    inicializarTabela(data);
                })
                .catch(error => {
                    console.log('Erro ao carregar dados do arquivo ranking.json:', error.message);
                    inicializarTabela([]);
                });
        }

        function inicializarTabela(dados) {
            if (!dados || dados.length === 0) {
                console.log('Nenhum dado dispon칤vel');
                return;
            }

            // Ordena os dados por votos (maior para menor)
            dados.sort((a, b) => b.votos - a.votos);
            
            // Calcula o m치ximo de votos para as barras de progresso
            const maxVotos = Math.max(...dados.map(d => d.votos));
            
            // Atualiza o total de projetos
            document.getElementById('total-projetos').textContent = dados.length;
            
            // Limpa a tabela existente se j치 houver uma inst칙ncia
            if (dataTableInstance) {
                dataTableInstance.destroy();
            }

            // Limpa o tbody
            const tbody = document.querySelector('#ranking-table tbody');
            tbody.innerHTML = '';
            
            // Adiciona as linhas diretamente no HTML
            dados.forEach((projeto, index) => {
                const posicao = index + 1;
                const porcentagem = maxVotos > 0 ? Math.round((projeto.votos / maxVotos) * 100) : 0;
                
                // Define a classe do badge baseada na posi칞칚o
                let badgeClass = 'regular';
                if (posicao === 1) badgeClass = '';
                else if (posicao === 2) badgeClass = 'silver';
                else if (posicao === 3) badgeClass = 'bronze';
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="position-badge ${badgeClass}">${posicao}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-semibold text-gray-900">${projeto.titulo}</div>
                        ${projeto.numero ? `<div class="text-sm text-gray-500">Projeto #${projeto.numero}</div>` : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-2">
                            <span class="font-bold text-lg text-blue-600">${projeto.votos}</span>
                            <span class="text-sm text-gray-500">votos</span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="w-full">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-sm text-gray-600">${porcentagem}%</span>
                            </div>
                            <div class="barra-container">
                                <div class="barra-progresso" style="width: ${porcentagem}%;"></div>
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Inicializa a DataTable com a tabela j치 populada
            setTimeout(() => {
                dataTableInstance = new simpleDatatables.DataTable("#ranking-table", {
                    searchable: true,
                    sortable: true,
                    perPage: 10,
                    perPageSelect: [5, 10, 15, 20],
                    labels: {
                        placeholder: "Buscar projetos...",
                        searchTitle: "Buscar na tabela",
                        pageTitle: "P치gina {page}",
                        perPage: "projetos por p치gina",
                        noRows: "Nenhum projeto encontrado",
                        info: "Mostrando {start} a {end} de {rows} projetos",
                        noResults: "Nenhum resultado encontrado para sua busca"
                    },
                    classes: {
                        active: "bg-blue-600 text-white",
                        disabled: "opacity-50 cursor-not-allowed"
                    }
                });

                // Personaliza o estilo da DataTable ap칩s a inicializa칞칚o
                setTimeout(() => {
                    // Estiliza o campo de busca
                    const searchInput = document.querySelector('.dataTable-input');
                    if (searchInput) {
                        searchInput.classList.add('border-gray-300', 'rounded-lg', 'px-4', 'py-2', 'focus:ring-blue-500', 'focus:border-blue-500');
                    }

                    // Estiliza o seletor de itens por p치gina
                    const perPageSelect = document.querySelector('.dataTable-selector');
                    if (perPageSelect) {
                        perPageSelect.classList.add('border-gray-300', 'rounded-lg', 'px-3', 'py-2', 'focus:ring-blue-500', 'focus:border-blue-500');
                    }

                    // Estiliza os bot칫es de pagina칞칚o
                    const paginationButtons = document.querySelectorAll('.dataTable-pagination a');
                    paginationButtons.forEach(button => {
                        button.classList.add('px-3', 'py-2', 'mx-1', 'border', 'border-gray-300', 'rounded-lg', 'hover:bg-gray-50', 'transition-colors');
                    });
                }, 200);
            }, 100);
        }

        // Carrega o ranking quando a p치gina 칠 carregada
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM carregado, iniciando carregamento do ranking...');
            carregarRanking();
        });
    </script>
</body>
</html>